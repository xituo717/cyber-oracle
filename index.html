<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Oracle DEBUG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adsgram.ai/js/adsgram.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        body { font-family: 'Share Tech Mono', monospace; background-color: #000; color: #00ff41; overflow-y: auto; padding-bottom: 100px; }
        .neon-border { border: 1px solid #00ff41; box-shadow: 0 0 10px #00ff41; }
        /* è°ƒè¯•é¢æ¿æ ·å¼ */
        #debug-console {
            position: fixed; top: 0; left: 0; width: 100%; 
            background: rgba(20,0,0,0.9); border-bottom: 2px solid red;
            color: #ff3333; font-size: 10px; padding: 10px; z-index: 9999;
            max-height: 150px; overflow-y: auto; display: block;
        }
    </style>
</head>
<body class="flex flex-col items-center pt-32 px-4">

    <div id="debug-console">
        <div>[SYSTEM] åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ...</div>
    </div>

    <h1 class="text-4xl font-bold mb-8">DEBUG MODE</h1>

    <div class="w-64 h-80 neon-border rounded-xl flex items-center justify-center bg-black mb-8">
        <div id="card-display" class="text-6xl">?</div>
    </div>

    <button id="main-btn" onclick="runDebugClick()" class="px-8 py-4 bg-gray-900 border border-[#00ff41] text-[#00ff41] text-xl font-bold rounded w-full max-w-xs active:bg-[#00ff41] active:text-black">
        CLICK TO TEST
    </button>

    <div class="mt-8 text-xs text-gray-500 text-center">
        v3.0 DIAGNOSTIC | <span id="status-text">Waiting...</span>
    </div>

    <script>
        // ğŸ› ï¸ 1. ç®€æ˜“æ—¥å¿—å‡½æ•° (æŠŠé”™è¯¯æ‰“å°åˆ°å±å¹•ä¸Š)
        function log(msg, isError = false) {
            const consoleDiv = document.getElementById('debug-console');
            const line = document.createElement('div');
            line.innerText = `> ${msg}`;
            if (isError) line.style.color = '#ff0000';
            else line.style.color = '#00ff41';
            consoleDiv.appendChild(line);
            console.log(msg); // åŒæ—¶ä¹Ÿæ‰“åˆ°æ§åˆ¶å°
        }

        // æ•è·å…¨å±€é”™è¯¯
        window.onerror = function(message, source, lineno, colno, error) {
            log(`âŒ å…¨å±€å´©æºƒ: ${message} (Line: ${lineno})`, true);
        };

        // ğŸ› ï¸ 2. æ£€æŸ¥ç¯å¢ƒ
        let tg;
        try {
            log("æ­£åœ¨æ£€æŸ¥ Telegram SDK...");
            if (window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                tg.expand();
                log("âœ… Telegram SDK åŠ è½½æˆåŠŸ!");
            } else {
                log("âš ï¸ Telegram SDK æœªæ‰¾åˆ° (å¯èƒ½ç½‘ç»œå±è”½)", true);
            }
        } catch (e) {
            log(`âŒ SDK åˆå§‹åŒ–é”™è¯¯: ${e.message}`, true);
        }

        try {
            log("æ­£åœ¨æ£€æŸ¥ Adsgram SDK...");
            if (window.Adsgram) {
                log("âœ… Adsgram SDK å°±ç»ª (v" + (window.Adsgram.version || 'Unknown') + ")");
            } else {
                log("âš ï¸ Adsgram SDK æœªåŠ è½½ (è¿™ä¼šå¯¼è‡´å¹¿å‘Šæ— æ³•æ’­æ”¾)", true);
            }
        } catch (e) {
            log(`âŒ Adsgram æ£€æŸ¥é”™è¯¯: ${e.message}`, true);
        }

        // ğŸ› ï¸ 3. æŒ‰é’®ç‚¹å‡»æµ‹è¯•é€»è¾‘
        async function runDebugClick() {
            log("ğŸ‘‰ æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼");
            const btn = document.getElementById('main-btn');
            btn.innerText = "RUNNING...";

            // å¼ºåˆ¶éœ‡åŠ¨
            if (tg && tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');

            // å°è¯•è°ƒèµ·å¹¿å‘Š
            if (window.Adsgram) {
                log("ğŸ”„ å°è¯•è°ƒç”¨å¹¿å‘Š (BlockID: 20376)...");
                try {
                    const AdController = window.Adsgram.init({ blockId: "20376" });
                    
                    // 3ç§’è¶…æ—¶æœºåˆ¶
                    const timeout = new Promise(r => setTimeout(() => r('timeout'), 3000));
                    
                    log("â³ ç­‰å¾…å¹¿å‘Šå“åº”...");
                    const result = await Promise.race([AdController.show(), timeout]);

                    if (result === 'timeout') {
                        log("âš ï¸ å¹¿å‘ŠåŠ è½½è¶…æ—¶ (3s)ï¼Œè·³è¿‡ã€‚");
                        showSuccess("è¶…æ—¶è·³è¿‡");
                    } else {
                        log("âœ… å¹¿å‘Šæ’­æ”¾ç»“æŸ/è·³è¿‡ã€‚");
                        showSuccess("æ’­æ”¾å®Œæˆ");
                    }
                } catch (err) {
                    log(`âŒ å¹¿å‘ŠæŠ¥é”™: ${err.message || err}`, true);
                    showSuccess("æŠ¥é”™è·³è¿‡");
                }
            } else {
                log("âš ï¸ æ— å¹¿å‘Šç¯å¢ƒï¼Œç›´æ¥æ‰§è¡Œã€‚");
                showSuccess("æ— å¹¿å‘Šç›´è¿");
            }
        }

        function showSuccess(reason) {
            const btn = document.getElementById('main-btn');
            btn.innerText = "SUCCESS!";
            btn.style.backgroundColor = "#00ff41";
            btn.style.color = "#000";
            document.getElementById('card-display').innerText = "ğŸ‰";
            log(`âœ… æµç¨‹è·‘é€š: ${reason}`);
            alert(`æµ‹è¯•æˆåŠŸï¼åŸå› : ${reason}`);
        }
    </script>
</body>
</html>